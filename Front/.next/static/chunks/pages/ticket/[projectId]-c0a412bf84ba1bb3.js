(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[351],{41045:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/ticket/[projectId]",function(){return s(3715)}])},95191:(e,t,s)=>{"use strict";var a=s(24994);t.A=void 0;var i=a(s(58117)),n=s(74848);t.A=(0,i.default)((0,n.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},3715:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var a=s(74848),i=s(96540),n=s(80108),r=s(95191);s(89805),s(39671);var d=s(94335);async function c(e,t){try{return(await d.A.get("https://centralized.fr/api/ticket/"+e+"/user",{headers:{Authorization:`Bearer ${t}`}})).data}catch(e){console.log(e)}}var l=s(19628);let o="https://centralized.fr/api/";function u({id:e,title:t,start:s,end:n,urgence:r,updated_at:u,status:h,planningId:p,userData:j,description:x,mail:g,projectId:v}){let[_,m]=(0,i.useState)({start_date:s,end_date:n,planningId:p,userId:j.user.id,title:t,urgenceId:r,description:x,status:h}),[f,N]=(0,i.useState)(!1),[k,I]=(0,i.useState)([{}]),C=new Date,w=new Date(u),y=Number(C)-Number(w);async function b(){200==(await d.A.patch(`${o}ticket/`+e,_,{headers:{Authorization:`Bearer ${j.user.token}`}})).status&&window.location.reload()}async function D(){200==(await d.A.delete(`${o}ticket/`+e,{headers:{Authorization:`Bearer ${j.user.token}`}})).status&&window.location.reload()}return(0,i.useEffect)(()=>{c(e,j.user.token).then(e=>{m({..._,userId:e.user.user_id})}),(0,l.A)(v,j.user.token).then(e=>{I(e)})},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{"data-cy":"box_ticket_card",className:"card",style:{borderLeft:"7px solid "+({0:"#8BC729",1:"#0083E1",2:"#ffa60063",3:"#ff000038"})[_.urgenceId],cursor:"pointer"},onClick:()=>N(!0),children:[(0,a.jsx)("h3",{"data-cy":"name_ticket_card",children:t}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{"data-cy":"period_ticket_card",children:[s.substring(0,10)," - ",n.substring(0,10)]}),(0,a.jsxs)("p",{"data-cy":"urgence_ticket_card",children:["Status : ",h]})]}),(0,a.jsxs)("p",{"data-cy":"maj_ticket_card",className:"card_date",children:["Dernier maj :"," ",(0,a.jsxs)("strong",{children:["il y a ",(y/864e5).toString().split(".")[0]," jours"]})]})]}),f?(0,a.jsx)("div",{className:"ticket_modal",children:(0,a.jsxs)("div",{className:"ticket_main_modal",children:[(0,a.jsx)("img",{src:"/assets/icons/icon-cross.svg",alt:"",className:"cross",onClick:()=>N(!1)}),(0,a.jsxs)("div",{className:"ticket_form",children:[(0,a.jsx)("h3",{children:"Modifier votre ticket"}),(0,a.jsxs)("div",{className:"same_line",children:[(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Titre *"}),(0,a.jsx)("input",{type:"text",placeholder:"Cr\xe9ation du ticket",value:_.title,onChange:e=>m({..._,title:e.target.value})})]}),(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Date de d\xe9but"}),(0,a.jsx)("input",{type:"date",placeholder:"Date de d\xe9but",value:_.start_date.substring(0,10),onChange:e=>m({..._,start_date:e.target.value.trim()})})]}),(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Date de fin"}),(0,a.jsx)("input",{type:"date",placeholder:"Date de fin",value:_.end_date.substring(0,10),onChange:e=>m({..._,end_date:e.target.value.trim()})})]})]}),(0,a.jsxs)("div",{className:"second_line",children:[(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Status"}),(0,a.jsxs)("select",{onChange:e=>{let t=e.target.value.trim();m({..._,status:t})},required:!0,children:[(0,a.jsx)("option",{value:"a faire",selected:"a faire"===_.status,children:"\xc0 faire"}),(0,a.jsx)("option",{value:"en cours",selected:"en cours"===_.status,children:"En cours"}),(0,a.jsx)("option",{value:"en retard",selected:"en retard"===_.status,children:"En retard"}),(0,a.jsx)("option",{value:"r\xe9solu",selected:"r\xe9solu"===_.status,children:"R\xe9solu"})]})]}),(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Urgence"}),(0,a.jsxs)("select",{onChange:e=>{let t=parseInt(e.target.value);m({..._,urgenceId:t})},required:!0,children:[(0,a.jsx)("option",{value:0,selected:0===_.urgenceId,children:"Mineur"}),(0,a.jsx)("option",{value:1,selected:1===_.urgenceId,children:"Moyen"}),(0,a.jsx)("option",{value:2,selected:2===_.urgenceId,children:"Majeur"}),(0,a.jsx)("option",{value:3,selected:3===_.urgenceId,children:"Urgent"})]})]})]}),(0,a.jsx)("div",{className:"third_line",children:(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Description"}),(0,a.jsx)("textarea",{value:_.description,onChange:e=>m({..._,description:e.target.value})})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{onChange:e=>m({..._,userId:e.target.value.trim()}),required:!0,children:[(0,a.jsx)("option",{value:"",children:"Veuillez choisir une personne"}),k.length>0?k.map(e=>(0,a.jsx)("option",{value:e.id,selected:_?.userId===e.id,children:e.user_firstname+" "+e.user_lastname},e.id)):null]})}),(0,a.jsxs)("div",{className:"buttn_container",children:[(0,a.jsx)("button",{className:"next_btn",onClick:b,children:"Valider"}),(0,a.jsx)("button",{className:"delete_btn",onClick:D,children:"Supprimer"})]})]})]})}):null]})}s(69029);let h=function({userData:e,selectedProject:t}){let[s,n]=(0,i.useState)({start_date:new Date().toISOString().split("T")[0],end_date:new Date().toISOString().split("T")[0],planningId:t.ticket.planning[0].id,user:e.user.id,title:"",urgenceId:0,description:"",status:"a faire"}),[r,c]=(0,i.useState)([{}]);async function o(){await d.A.post("https://centralized.fr/api/ticket",s,{headers:{Authorization:`Bearer ${e.user.token}`}}),window.location.reload()}return(0,i.useEffect)(()=>{(0,l.A)(t.id,e.user.token).then(e=>{c(e)})},[]),(0,a.jsxs)("div",{className:"ticket_form",children:[(0,a.jsx)("h3",{children:"Cr\xe9ez votre ticket"}),(0,a.jsxs)("div",{className:"same_line",children:[(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Titre *"}),(0,a.jsx)("input",{type:"text",placeholder:"Cr\xe9ation du ticket",name:"",id:"",onChange:e=>n({...s,title:e.target.value.trim()})})]}),(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Date de d\xe9but"}),(0,a.jsx)("input",{type:"date",placeholder:"Date de d\xe9but",onChange:e=>n({...s,start_date:e.target.value.trim()})})]}),(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Date de fin"}),(0,a.jsx)("input",{type:"date",placeholder:"Date de fin",onChange:e=>n({...s,end_date:e.target.value.trim()})})]})]}),(0,a.jsxs)("div",{className:"second_line",children:[(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Status"}),(0,a.jsxs)("select",{onChange:e=>n({...s,status:e.target.value.trim()}),required:!0,children:[(0,a.jsx)("option",{value:"a faire",children:"\xc0 faire"}),(0,a.jsx)("option",{value:"en cours",children:"En cours"}),(0,a.jsx)("option",{value:"en retard",children:"En retard"}),(0,a.jsx)("option",{value:"r\xe9solu",children:"R\xe9solu"})]})]}),(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Urgence"}),(0,a.jsxs)("select",{onChange:e=>n({...s,urgenceId:parseInt(e.target.value)}),required:!0,children:[(0,a.jsx)("option",{value:0,children:"Mineur"}),(0,a.jsx)("option",{value:1,children:"Moyen"}),(0,a.jsx)("option",{value:2,children:"Majeur"}),(0,a.jsx)("option",{value:3,children:"Urgent"})]})]})]}),(0,a.jsx)("div",{className:"third_line",children:(0,a.jsxs)("div",{className:"input_grp",children:[(0,a.jsx)("p",{children:"Description"}),(0,a.jsx)("textarea",{name:"",id:"",onChange:e=>n({...s,description:e.target.value})})]})}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{onChange:e=>n({...s,user:e.target.value.trim()}),required:!0,children:[(0,a.jsx)("option",{value:"",children:"Veuillez choisir une personne"}),r.length>0?r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.user_firstname+" "+e.user_lastname},e.id)):null]})}),(0,a.jsx)("button",{className:"next_btn",onClick:()=>o(),children:"Valider"})]})};function p({userData:e,updateUserData:t}){let[s,d]=(0,i.useState)(!1),[c,l]=(0,i.useState)({id:""}),[o,p]=(0,i.useState)({todo:[],inprogress:[],late:[],done:[]});return(0,i.useEffect)(()=>{let t={todo:[],inprogress:[],late:[],done:[]};for(let s of e.project)if(s.id==new URL(window.location.href).pathname.split("/")[2]&&(l(s),void 0!=s.ticket.ticket))for(let e of s.ticket.ticket)"a faire"===e.status?t.todo.push(e):"r\xe9solu"===e.status?t.done.push(e):"en retard"===e.status?t.late.push(e):"en cours"===e.status&&t.inprogress.push(e);p(t)},[e]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"ticketPage",children:[(0,a.jsxs)("div",{className:"header",children:[(0,a.jsx)("h1",{children:"Gestion des tickets"}),(0,a.jsx)(n.A,{"data-cy":"button_create_ticket",onClick:()=>d(!0),children:(0,a.jsx)(r.A,{fontSize:"medium",sx:{color:"#000000"}})})]}),(0,a.jsx)("hr",{style:{marginLeft:0}}),(0,a.jsxs)("div",{className:"ticket_container",children:[(0,a.jsxs)("div",{className:"debut_container",children:[(0,a.jsxs)("div",{className:"todo_container",children:[(0,a.jsx)("h2",{children:"A faire"}),(0,a.jsx)("div",{className:"card_container",children:o.todo.map(t=>(0,a.jsx)(u,{id:t.id,title:t.title,start:t.start_date,end:t.end_date,urgence:t.urgenceId,status:t.status,planningId:t.planningId,updated_at:t.updated_at,userData:e,description:t.description,mail:t.description,projectId:c.id},t.id))})]}),(0,a.jsxs)("div",{className:"inprogress_container",children:[(0,a.jsx)("h2",{children:"En cours"}),(0,a.jsx)("div",{className:"card_container",children:o.inprogress.map(t=>(0,a.jsx)(u,{id:t.id,title:t.title,start:t.start_date,end:t.end_date,urgence:t.urgenceId,status:t.status,planningId:t.planningId,updated_at:t.updated_at,userData:e,description:t.description,mail:t.description,projectId:c.id},t.id))})]})]}),(0,a.jsxs)("div",{className:"fin_container",children:[(0,a.jsxs)("div",{className:"late_container",children:[(0,a.jsx)("h2",{children:"En retard"}),(0,a.jsx)("div",{className:"card_container",children:o.late.map(t=>(0,a.jsx)(u,{id:t.id,title:t.title,start:t.start_date,end:t.end_date,urgence:t.urgenceId,status:t.status,planningId:t.planningId,updated_at:t.updated_at,userData:e,description:t.description,mail:t.description,projectId:c.id},t.id))})]}),(0,a.jsxs)("div",{className:"done_container",children:[(0,a.jsx)("h2",{children:"R\xe9solu"}),(0,a.jsx)("div",{className:"card_container",children:o.done.map(t=>(0,a.jsx)(u,{id:t.id,title:t.title,start:t.start_date,end:t.end_date,urgence:t.urgenceId,status:t.status,planningId:t.planningId,updated_at:t.updated_at,userData:e,description:t.description,mail:t.description,projectId:c.id},t.id))})]})]})]}),s?(0,a.jsx)("div",{className:"ticket_modal",children:(0,a.jsxs)("div",{className:"ticket_main_modal",children:[(0,a.jsx)("img",{src:"/assets/icons/icon-cross.svg",alt:"",className:"cross",onClick:()=>void d(!1)}),(0,a.jsx)(h,{userData:e,selectedProject:c})]})}):null]})})}},19628:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(94335);async function i(e,t){try{return(await a.A.get("https://centralized.fr/api/teamuser/project/"+e,{headers:{Authorization:`Bearer ${t}`}})).data}catch(e){console.log(e)}}},39671:()=>{},69029:()=>{},89805:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[108,636,593,792],()=>t(41045)),_N_E=e.O()}]);